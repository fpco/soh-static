<!DOCTYPE html>
<html><head><title>Part 1 - School of Haskell | School of Haskell</title><meta http-equiv="x-ua-compatible" content="IE=9"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="google-site-verification" content="Rfxk2TdeMMXEXHgJ2_OO8Rt3hPbQSDao0OXQV_n6z_s" /><link href="//fonts.googleapis.com/css?family=Merriweather" rel="stylesheet" type="text/css"><link href="https://www.schoolofhaskell.com/recent-content/feed" type="application/rss+xml" rel="alternate" title="Recently published content">
<link rel="stylesheet" href="https://www.schoolofhaskell.com/static/combined/UlwEHVcM.css"><style>.social{margin-right:1em}h1{font-family:Merriweather !important}article{font-family:Merriweather !important}article li{font-family:Merriweather !important;line-height:1.6em}h1,h2,h3,h4,h4,h5{font-family:Merriweather !important}.editor p{font-family:Frutiger, "Frutiger Linotype", Univers, Calibri, "Gill Sans", "Gill Sans MT", "Myriad Pro", Myriad, "DejaVu Sans Condensed", "Liberation Sans", "Nimbus Sans L", Tahoma, Geneva, "Helvetica Neue", Helvetica, Arial, sans-serif}.article-footer{border-top:1px solid #ddd;padding-top:1em;margin-top:1em}body{font-size:16px !important}.navbar .navbar-inner{background:#3c3f41}.navbar .brand{font-size:14px}.navbar .brand img{width:6em}.navbar .icon-wrench{margin:0 -0.5em 0 -0.5em;padding:0 1em 0 1em;height:20px}.navbar-inverse .nav .active a{background:#333638}.navbar-inverse .nav > li > a{color:#a7a7a7
}.navbar-inverse .btn-navbar{background:#333638}.navbar-inverse .nav > li a:hover,.navbar-inverse .btn{background:#333537 !important}@media (max-width: 979px) {.icon-wrench{padding-left:1em !important}}.breadcrumb{border-top-left-radius:0;border-top-right-radius:0}h1{margin-top:20px}.breadcrumb-container + .main-content h1{margin-top:0}.footer{padding:30px 0;margin-top:70px;border-top:1px solid #e5e5e5;background-color:#f5f5f5}.footer ul.footer-menu{list-style-type:none}.footer ul.footer-menu li{display:inline-block}.footer ul.footer-menu li + li{margin-left:0.5em}.footer ul.footer-menu li + li:before{margin-right:0.5em;content:"Â·";color:#999}.footer ul.menu li{display:inline-block}.footer ul.menu li + li{margin-left:0.5em}.footer .copyright{margin-left:25px}.main-content{min-height:100%}.gravatar{width:80px;height:80px;border-radius:2px;background:#eee}.empty-gravatar{width:0}.container{font-family:"Segoe UI", Candara, "Bitstream Vera Sans", "DejaVu Sans", "Bitstream Vera Sans", "Trebuchet MS", Verdana, "Verdana Ref", sans-serif}.container h1,.container h2,.container h4,.container h4,.container h5{font-family:"Segoe UI", Candara, "Bitstream Vera Sans", "DejaVu Sans", "Bitstream Vera Sans", "Trebuchet MS", Verdana, "Verdana Ref", sans-serif}article{font-family:Merriweather !important}article h1{font-family:Merriweather !important}article li{font-family:Merriweather !important;line-height:1.6em}article li + li{margin-top:0.5em}article div.code{background:#f9f9f9;border:1px solid #d1d1d1;position:relative;border-radius:0.2em;margin:0.25em 0 0.75em 0;min-height:2.5em}article code{color:#005580;font-size:14px;white-space:pre}article a.hoogle > code{color:#0088cc;font-size:14px;white-space:pre;border:0}article .expand-code{display:none}article pre{overflow:auto;word-wrap:normal}article code.active{display:block;max-height:430px}article h1{font-size:31.5px}article h3{font-size:17.5px}article h4{font-size:14px}article h5,article h6{font-size:11.9px}article p{line-height:1.7em}article h1 code,article h2 code,article h3 code,article h4 code,article h5 code,article h6 code{font-size:inherit !important}article h1 a,article h2 a,article h3 a,article h4 a,article h5 a,article h6 a{color:#444}article h1 a:before,article h2 a:before,article h3 a:before,article h4 a:before,article h5 a:before,article h6 a:before{margin-left:-1.5em;padding-right:0.5em;font-family:fontawesome;content:"\f0c1";font-size:20px;color:#fff}article h1 a:hover,article h2 a:hover,article h3 a:hover,article h4 a:hover,article h5 a:hover,article h6 a:hover{text-decoration:none;color:#0088cc}article h1 a:hover:before,article h2 a:hover:before,article h3 a:hover:before,article h4 a:hover:before,article h5 a:hover:before,article h6 a:hover:before{color:#888}article h2{font-size:24.5px}article .popover{font-family:actor}article .popover h3.popover-title{font-family:actor !important;font-size:1em}article .popover .popover-content{width:15em;font-size:1em}article .controlsRun{display:block;padding:0.5em;text-align:right;background:#f2f2f2}article .controlsRun a.clone{margin-right:1em;font-family:actor;text-decoration:none}article .controlsRun a.clone span{padding-left:0.5em}article .controlsRun a.run,article .controlsRun a.reset,article .controlsRun a.show-code{font-size:16px}article .controlsRun a.run span,article .controlsRun a.reset span,article .controlsRun a.show-code span{display:none}article .controlsRun a.reset{margin-left:0.5em;color:#a2becc}article .controlsRun a.reset{display:none}article .controlsRun a.show-code{margin-right:0.75em}article .controlsRun a.run:hover,article .controlsRun a.show-code:hover{text-decoration:none}article .controlsRun a.show-code.active{color:#DC0D0D}article .controlsRun a[disabled]{color:#a2becc;cursor:default}article .collapse-area .collapse-header{background:#0088cc;color:#fff;padding:0.3em;cursor:pointer}article .collapse-area .hidden-toggle:before{content:"\f0d7";font-family:fontawesome;margin-right:0.5em;margin-left:0.25em}article .collapse-area .collapsed-files{overflow:auto;height:auto}article .collapse-area.collapse-disabled{display:none}article .collapse-area.collapse-area-off .collapsed-files{height:0px;overflow:hidden}article .collapse-area.collapse-area-off .hidden-toggle:before{content:"\f0da"}article .snippet-stdio .stdout{margin:0.5em;padding-right:2em;position:relative;word-wrap:break-word}article .snippet-stdio .stdin{-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;-webkit-transition:none;-moz-transition:none;-o-transition:none;transition:none;padding:0;margin:0}article .hoogle-results{margin:0.25em}article .hoogle-results .hoogle-inner{background:#fff;padding:0.5em;border-radius:3px;border:1px solid #ddd}article .hoogle-results .hoogle-inner .close-link{position:relative;float:right;margin-top:-0.5em;margin-right:-0.5em}article .snippet-output-errors{margin:1em 0.5em 0.5em 0.5em;position:relative}article .snippet-output-errors ul{list-style-type:none;margin:0;position:relative}article .snippet-output-errors pre{border:0;border-radius:0;padding:0.25em;margin:0;background:inherit;color:inherit}article .snippet-output-errors .close-link{color:inherit;background:inherit}article .snippet-editors{z-index:0;padding:0.25em}article .close-link{padding:0.5em;background:#eaeaea;border-bottom-left-radius:0.2em;border-top-right-radius:0.2em;position:absolute;top:0;right:0}article .close-link:hover{text-decoration:none}article .snippet-title{padding:0.5em 0 0 0.5em}article .snippet-title .snippet-icon{font-family:FontAwesome;display:inline-block;margin-right:0.5em}article .fullModuleCode + div .snippet-title{margin-top:0.5em;border-top:1px solid #ccc;padding-top:0.5em}article .CodeMirror{height:auto;min-height:1em;line-height:1.5em;background:transparent;font-size:14px !important}article .CodeMirror .highlighted{background:rgba(250, 210, 0, 0.45) !important}article .CodeMirror-widget{margin-left:2em;line-height:1.8}article .CodeMirror.collapsed{height:10em !important}article .editor .expander{text-align:center;display:block;padding:0.5em;text-decoration:none;border-bottom-left-radius:2px;border-bottom-right-radius:2px}article .editor .expander .ellipsis{background:white;border:1px solid #ccc;padding:0 0.5em;height:1em;line-height:0.5em;display:inline-block;color:#555;cursor:pointer}article .editor .expander .ellipsis:hover{background:#ddd;color:#333}article .web-runner{margin:0.5em;padding:0.5em;border:1px solid #ccc;border-radius:3px;background:#f5f5f5}article .web-runner iframe{border:0;margin-top:0.5em;margin-bottom:0;background:white}article .web-runner .controls i{cursor:pointer;color:#0088cc}article .web-runner .controls i:hover{color:#222}article .web-runner .controls i + i{margin-left:0.5em}article .web-runner .controls .icon-remove{float:right}article .hidden{display:block;visibility:visible}article .controlsShowHide{margin-bottom:0.5em}.tutorial-body{float:left !important}.tutorial-nav{float:right !important}@media (max-width: 979px) {.related-content{float:right}.author-name{display:block;margin-left:20px !important;padding-left:5px;margin-top:5px}article h1 a:hover:before,article h2 a:hover:before,article h3 a:hover:before,article h4 a:hover:before,article h5 a:hover:before,article h6 a:hover:before{color:#fff}.tutorial-nav{float:none !important;width:auto !important}.tutorial-body{float:none !important;width:auto !important}}@media (min-width: 980px) and (max-width: 1199px) {.navbar-search{display:none}.tutorial-nav{width:200px}.tutorial-body{width:720px}}#accountPage h1{margin:20px 0 0 0}#accountPage h2{font-size:20px}.group-contents .span8{float:left}.group-contents .span4{float:right}.container > .alert-block{margin-top:1em}.alert{color:#aa874a
}.social{margin-bottom:.8em;display:block}.social a{text-decoration:none}.social i{font-size:1.1em;color:#fff;padding:0.25em;border-radius:0.25em;width:1em;display:inline-block;text-align:center}.social i.icon-twitter{background:#0088cc}.social i.icon-facebook{background:#3b5998
  }.social i.icon-google-plus{background:#dd4b39
  }.well pre{background:#fcfcfc}.well h2{margin-top:0}code{color:#005580;font-size:14px;white-space:pre}</style><!--[if lt IE 8]><link rel="stylesheet" href="https://www.schoolofhaskell.com/static/design/css/ie7.css?etag=TSMl9x1V"><![endif]--><!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--></head><body class="not-logged-in" itemscope itemtype="http://schema.org/Product"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-H62P" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-H62P');</script><div class="navbar navbar-inverse navbar-static-top"><div class="navbar-inner"><div class="container"><a class="btn btn-navbar" type="button" data-toggle="collapse" data-target=".nav-collapse"><span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</a>
<a class="brand" href="/"><img src="/static/img/haskell-logo-wide.png" title="School of Haskell">
</a>
<div class="nav-collapse collapse"><ul class="nav"><li><a href="https://www.schoolofhaskell.com/">School</a>
</li>
<li><a href="https://www.schoolofhaskell.com/user">Users</a>
</li>
</ul>
<form class="navbar-search pull-left" action="https://www.schoolofhaskell.com/search"><input class="search-query" type="text" placeholder="Search" name="search">
</form>
</div>
</div>
</div>
</div>
<div class="container breadcrumb-container"><div class="row"><div class="span12"><ul class="breadcrumb"><li><a href="https://www.schoolofhaskell.com/">School of Haskell</a>
<span class="divider">/</span>
</li>
<li><a href="https://www.schoolofhaskell.com/school/advanced-haskell">Advanced Haskell</a>
<span class="divider">/</span>
</li>
<li><a href="https://www.schoolofhaskell.com/school/advanced-haskell/building-a-file-hosting-service-in-yesod">Building a File Hosting Service in Yesod</a>
<span class="divider">/</span>
</li>
<li><a href="https://www.schoolofhaskell.com/school/advanced-haskell/building-a-file-hosting-service-in-yesod/part%201">Part 1</a>
</li>
</ul>
</div>
</div>
</div>
<div class="container main-content"><div class="row"><div class="span12"><h1 itemprop="name">Part 1</h1>
</div>
</div>
<div class="row"><div class="span7 meta"><p><span class="date">25 Feb 2015</span>
<span class="author"><a href="https://www.schoolofhaskell.com/user/school">School of Haskell</a>
</span>
<span class="view-edit-link pull-right"><a class="view-source-link" href="https://www.schoolofhaskell.com/tutorial-raw/30/ef673d9dcb2ae97873ee44836bf1fd5692dbff32">View Markdown source</a>
</span>
</p>
<p class="tags"></p>
</div>
</div>
<div class="row"><div class="span7 meta"><span class="sociallinksunicode social">
<a href="https://twitter.com/home?status=$url$" target="_blank"><i class="icon-twitter"></i></a>&nbsp;
<a href="http://www.facebook.com/sharer/sharer.php?u=$url$" target="_blank"><i class="icon-facebook"></i></a>&nbsp;
<a href="https://plus.google.com/share?url=$url$" target="_blank"><i class="icon-google-plus"></i></a></span>
</div>
</div>
<p class="alert">As of March 2020, School of Haskell has been switched to read-only mode.</p>
<div class="row" itemprop="desc"><div class="span4 tutorial-nav"><div class="related-content"><ul class="nav nav-tabs nav-stacked"><li><script>reddit_target='fpcomplete'</script>
<script src="https://redditstatic.s3.amazonaws.com/button/button1.js"></script>
</li>
<li><a href="https://www.schoolofhaskell.com/user/school/advanced-haskell/building-a-file-hosting-service-in-yesod/part%202">Next content: Part 2</a>
</li>
<li><a href="https://www.schoolofhaskell.com/school/advanced-haskell/building-a-file-hosting-service-in-yesod">Go up to: Building a File Hosting Service in Yesod</a>
</li>
</ul>

</div>
<div class="aside"><h3>Sections</h3>
<ul><li><a href="#introduction">Introduction</a></li><li><a href="#conventions">Conventions</a></li><li><a href="#minimal-example">Minimal Example</a><ul><li><a href="#language-extensions">Language extensions</a><ul><li><a href="#overloadedstrings">OverloadedStrings</a></li><li><a href="#templatehaskell-and-quasiquotes">TemplateHaskell and QuasiQuotes</a></li><li><a href="#typefamilies">TypeFamilies</a></li></ul></li><li><a href="#module-and-import-declarations">Module and Import Declarations</a></li><li><a href="#defining-the-foundation-type">Defining the Foundation Type</a></li><li><a href="#instantiating-the-yesod-typeclass">Instantiating the Yesod Typeclass</a></li><li><a href="#automatically-generating-boilerplate-">Automatically Generating Boilerplate.</a></li><li><a href="#writing-route-handler-actions">Writing Route Handler Actions</a></li><li><a href="#starting-the-server-process">Starting the Server Process</a></li></ul></li><li><a href="#a-closer-look-at-hamlet">A Closer Look at Hamlet</a><ul><li><a href="#nesting">Nesting</a></li><li><a href="#pulling-data-from-surroundings">Pulling Data from Surroundings</a></li><li><a href="#looping-through-a-list">Looping Through a List</a></li><li><a href="#conditionals">Conditionals</a></li></ul></li><li><a href="#summary">Summary</a></li></ul></div>
</div>
<div class="span8 tutorial-body" data-environment="ghc-7.8-stable-14.09">
<article><h2 id="introduction"><a href="#introduction">Introduction</a></h2><p>This tutorial is the first in a series of 4 tutorials on how to build a file 
hosting service using Yesod. Site visitors will be
able to upload collections of files, and later download those same files to a
different computer. We'll touch on issues you will likely encounter when
writing any web app such as HTML generation, styling, maintaining application
state, and managing form data.</p><p>The main goal of the tutorials are to show you how to get started
writing web applications using Haskell and the Yesod Web Framework. Each entry
will build on the last as we write a complete application from start to
finish.</p><p>The Yesod Web Framework is a complete package for developing web
applications. Yesod projects execute as an HTTP server that can be self-hosted
or interface with an existing server using methods such as FastCGI. A unique
system of mapping URL paths to handler functions make it so that broken links
trigger a compile-time error. Several miniature domain-specific languages aid
in the making of persistence layers, routing systems, and templates. Fragments
of HTML, CSS, and JavaScript can be packaged into components called
widgets. These can be combined with each other efficiently so that
clients receive a single copy of everything they need.</p><p>Many of Yesod's features will be left out of discussion. One of these is
Yesod's built-in support for automated testing. Another is Yesod's ability to
run applications such that templates are automatically reloaded at
runtime.</p><h2 id="conventions"><a href="#conventions">Conventions</a></h2><p>As we go I will follow a set of conventions in how examples appear,
programming constructs are referred to, and new material is presented. Being
aware of these conventions from the beginning may help you follow along.</p><p>When I refer to the name of a function, data type, or class which is found in
within the libraries supported by FP Complete, it will often be hyperlinked to
documentation. Examples might be the <a class="hoogle" href="https://www.stackage.org/lts/hoogle?q=lookup" title="Hoogle search for: lookup"><code>lookup</code></a> function from the</p><a class="hoogle" href="https://www.stackage.org/lts/hoogle?q=Data.List" title="Hoogle search for: Data.List"><code>Data.List</code></a> module. When I quote a short expression of code,
refer to a name defined within the project, or otherwise embed a programming
language fragment into the English prose, it will appear `like this`.<p>These tutorials are written using the FP School of Haskell learning site. 
Most of the provided code samples will be executable. These will have the usual FP 
School of Haskell &quot;play&quot; button in the upper-right hand corner. 
You are encouraged to experiment with these example applications, 
and to execute the modifications that you make. Over the course of this 
series the project will grow, so in each new section we will only
show files where changes have occurred. You will always be able to see the
hidden code by clicking on buttons which will appear in the upper-right hand
corner of the example.</p><p>Pay special attention to highlighted blocks within the examples. These are the
lines which have been changed or added. Comments represent lines of code as
they were in a previous example.</p><h1 id="minimal-example"><a href="#minimal-example">Minimal Example</a></h1><p>Let's start by writing a minimal web site that serves a single page of static
HTML. I'll walk you through the code line-by-line. Later on we will break this
application into several files, but everything will fit into the same pattern.</p><pre><code class="active haskell web">{-# START_FILE Main.hs #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE QuasiQuotes #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TypeFamilies #-}

module Main where

import Yesod

data App = App
instance Yesod App

mkYesod &quot;App&quot; [parseRoutes|
/ HomeR GET
|]

getHomeR :: Handler Html
getHomeR = defaultLayout $ do
    setTitle &quot;File Processor&quot;
    toWidget [whamlet|
&lt;h2&gt;Previously submitted files
|]

main :: IO ()
main = warpEnv App</code></pre><h2 id="language-extensions"><a href="#language-extensions">Language extensions</a></h2><pre><code class="haskell">{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE QuasiQuotes #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TypeFamilies #-}</code></pre><p>The first block of text is a collection of compiler pragmas declaring that
several language extensions will be used. We will briefly describe their
purpose here. See the GHC user guide for more information.</p><h3 id="overloadedstrings"><a href="#overloadedstrings">OverloadedStrings</a></h3><p>Overloaded strings allows us to use string literals where we would not
otherwise be able to. Take a look at the line reading, <code>setTitle &quot;File
Processor&quot;</code>. The <a class="hoogle" href="https://www.stackage.org/lts/hoogle?q=Yesod" title="Hoogle search for: Yesod"><code>setTitle</code></a> action expects the
type of its argument to be <a class="hoogle" href="https://www.stackage.org/lts/hoogle?q=Text.Blaze.Html" title="Hoogle search for: Text.Blaze.Html"><code>Html</code></a>, and
we've supplied a string literal. Standard Haskell would fix the type of our
string to <code>[Char]</code> or <code>String</code>, and report a type error.</p><p>Using overloaded strings is not required, but frees us from having to manually
convert string literals to the types we want. Without this extension we would
have needed to import the <code>Data.String</code> module and set the page title with,
<code>setTitle . fromString $ &quot;File Processor&quot;</code>.</p><p>We recommend trying this out as an exercise. Disable the OverloadedStrings
extension, and read the compiler error. Once you have done this,
change the line starting with &quot;setTitle&quot; so that the program will run. A
solution is included below.</p><div class="hidden"><pre><code class="active haskell web">{-# START_FILE Main.hs #-}
{-# LANGUAGE QuasiQuotes #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TypeFamilies #-}

module Main where

import Data.String
import Yesod

data App = App
instance Yesod App

mkYesod &quot;App&quot; [parseRoutes|
/ HomeR GET
|]

getHomeR :: Handler Html
getHomeR = defaultLayout $ do
    setTitle . fromString $ &quot;File Processor&quot;
    toWidget [whamlet|
&lt;h2&gt;Previously submitted files
|]

main :: IO ()
main = warpEnv App</code></pre></div><h3 id="templatehaskell-and-quasiquotes"><a href="#templatehaskell-and-quasiquotes">TemplateHaskell and QuasiQuotes</a></h3><p>The <code>TemplateHaskell</code> language extension enables compile-time
metaprogramming. Yesod uses this in a number of places to reduce and simplify
the amount of code we need to write. Much of our application's boilerplate
will be written for us.</p><p>Any function calls made from the top level of a source file are examples of
Template Haskell in use. The line reading <code>mkYesod &quot;App&quot; ...</code> is one such
place. We will describe what this line does later on.</p><p>The <code>QuasiQuotes</code> language extension is an addition to Template Haskell which
allows us to embed domain specific languages directly into Haskell source
files. Yesod includes several of these small languages, and our first example
uses 2 of them. The extension gets its name from the <code>[|</code> and <code>|]</code> tokens that
surround it. I'll highlight this extension's usage below:</p><pre><code class="haskell">mkYesod &quot;App&quot; {-hi-}[parseRoutes|
/ HomeR GET
|]{-/hi-}

getHomeR :: Handler Html
getHomeR = defaultLayout $ do
    setTitle . fromString $ &quot;File Processor&quot;
    toWidget {-hi-}[whamlet|
&lt;h2&gt;Previously submitted files
|]{-/hi-}</code></pre><h3 id="typefamilies"><a href="#typefamilies">TypeFamilies</a></h3><p>The <code>TypeFamilies</code> language extension is used internally by Yesod. We will not
be using it directly in this tutorial, but the extension will need to be
enabled in a few modules.</p><h2 id="module-and-import-declarations"><a href="#module-and-import-declarations">Module and Import Declarations</a></h2><pre><code class="haskell">module Main where

import Yesod</code></pre><p>Our hello world application includes everything in a single file. When we
expand on it I will show you the recommended way to organize a Yesod
project. The Yesod module exports most of the basic functionality for
writing a Yesod application.</p><h2 id="defining-the-foundation-type"><a href="#defining-the-foundation-type">Defining the Foundation Type</a></h2><pre><code class="haskell">{-hi-}data App = App{-/hi-}
instance Yesod App</code></pre><p>All Yesod sites contain a single &quot;foundation&quot; type. This type is used to hold
references to any state that the site needs to maintain. The type is
constructed once in the application's <code>main</code> function, and remains in memory
until the program terminates. Since our example has no state, the <code>App</code> constructor has no fields.</p><h2 id="instantiating-the-yesod-typeclass"><a href="#instantiating-the-yesod-typeclass">Instantiating the Yesod Typeclass</a></h2><pre><code class="haskell">instance Yesod App</code></pre><p>Our <code>App</code> data type has been made an instance of the <code>Yesod</code> type class. We
can now supply an <code>App</code> to functions which accept instances of Yesod as an
argument.</p><p>The Yesod type class includes many methods. They all contain default
implemantations that can be overridden. By writing <code>instance Yesod App</code>,
we've declared that all of the default methods should be used.</p><h2 id="automatically-generating-boilerplate-"><a href="#automatically-generating-boilerplate-">Automatically Generating Boilerplate.</a></h2><pre><code class="haskell">mkYesod &quot;App&quot; [parseRoutes|/ HomeR GET|]</code></pre><p>The <a class="hoogle" href="https://www.stackage.org/lts/hoogle?q=mkYesod" title="Hoogle search for: mkYesod"><code>mkYesod</code></a> template haskell function generates
most of the boilerplate needed to tie our <code>App</code> data type and the</p><a class="hoogle" href="https://www.stackage.org/lts/hoogle?q=Yesod" title="Hoogle search for: Yesod"><code>Yesod</code></a> type class together into a complete application. The
first argument is the name of our data type as a literal string. The second
argument is a declaration of our site's routes. Everything between
&quot;[parseRoutes|&quot; and &quot;|]&quot; is not Haskell, but a miniature language for
declaring how URLs should map to handler actions. The string, &quot;/ HomeR GET&quot;,
says that our site will listen for HTTP GET requests at the root path, and
will pass those requests to a handler function named getHomeR.<p>Yesod's <a class="hoogle" href="https://www.stackage.org/lts/hoogle?q=mkYesod" title="Hoogle search for: mkYesod"><code>mkYesod</code></a> Template Haskell function
generates data types and type aliases that are used by the rest of our
application. One such type alias is <code>Handler</code>, which is used in handler
functions.</p><h2 id="writing-route-handler-actions"><a href="#writing-route-handler-actions">Writing Route Handler Actions</a></h2><pre><code class="haskell">getHomeR :: Handler Html
getHomeR = defaultLayout $ do
    setTitle &quot;File Processor&quot;
    toWidget [whamlet|
&lt;h2&gt;Previously submitted files
|]</code></pre><p>Any route mentioned in our <a class="hoogle" href="https://www.stackage.org/lts/hoogle?q=parseRoutes" title="Hoogle search for: parseRoutes"><code>parseRoutes</code></a>
quasi-quoted fragment must have an associated handler function. There is a
convention for how handler functions should be named. Recall that our route
definition was <code>[parseRoutes|/ HomeR GET|]</code>. The <code>HomeR</code> fragment becomes the
name for our home page if we ever want to generate a hyperlink back to
it. Handler actions always have names starting with the HTTP verb they handle
followed by the name of the route.</p><p>In the first line we see <a class="hoogle" href="https://www.stackage.org/lts/hoogle?q=defaultLayout" title="Hoogle search for: defaultLayout"><code>defaultLayout</code></a> being
called. This is one of the Yesod type class's methods. It operates in a
special handler monad that the call to <a class="hoogle" href="https://www.stackage.org/lts/hoogle?q=mkYesod" title="Hoogle search for: mkYesod"><code>mkYesod</code></a>
generated for us. The <a class="hoogle" href="https://www.stackage.org/lts/hoogle?q=defaultLayout" title="Hoogle search for: defaultLayout"><code>defaultLayout</code></a> method takes
a &quot;widget&quot; action as an argument, and produces a block of HTML to be used in
the final HTTP response.</p><p>The next 3 lines make up our widget action. The call to</p><a class="hoogle" href="https://www.stackage.org/lts/hoogle?q=setTitle" title="Hoogle search for: setTitle"><code>setTitle</code></a> specifies what ends up in our final HTML's <code>&lt;title&gt;</code>
tag. Yesod uses a templating language called Hamlet to produce HTML. This is
what you see in the block starting with `toWidget [whamlet|` and ending in
`|]`. Hamlet supports a number of features that will be useful to us later
on. For now we're just generating static HTML that will end up in our ``
tag.<h2 id="starting-the-server-process"><a href="#starting-the-server-process">Starting the Server Process</a></h2><pre><code class="haskell">main :: IO ()
main = warpEnv App</code></pre><p>The <code>main</code> action is where we initialize configurations, open database
connections, or perform other up-front processes. Typically our foundation
data type, <code>App</code> in this case, will hold references to anything needed during
execution.</p><h1 id="a-closer-look-at-hamlet"><a href="#a-closer-look-at-hamlet">A Closer Look at Hamlet</a></h1><p>Earlier on We gave you a glimps of using Hamlet to generate static HTML. We want
to end this episode by showing you a few other features of Hamlet so you will
have something to experiment with.</p><h2 id="nesting"><a href="#nesting">Nesting</a></h2><p>Hamlet's syntax is similar to HTML in that text is marked up with angle
bracketted tags. You may have noticed in the example given above that We did
not type a closing tag. This is because Hamlet uses whitespace for
nesting. As an example, here is how you would make an unordered list:</p><pre><code class="active haskell web">{-# START_FILE Main.hs #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE QuasiQuotes #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TypeFamilies #-}

module Main where

import Yesod

data App = App
instance Yesod App

mkYesod &quot;App&quot; [parseRoutes|
/ HomeR GET
|]

getHomeR :: Handler Html
getHomeR = defaultLayout $ do
    setTitle &quot;File Processor&quot;
    toWidget [whamlet|
&lt;h2&gt;Previously submitted files
{-hi-}&lt;ul&gt;
    &lt;li&gt;readme.txt
    &lt;li&gt;report.pdf
    &lt;li&gt;music.wav{-/hi-}
|]

main :: IO ()
main = warpEnv App</code></pre><p>Try making a few modifications to get a feel for how nesting works. Any tag
starting at a later column than the one above it is considered a child
node. See how you might make an HTML table.</p><h2 id="pulling-data-from-surroundings"><a href="#pulling-data-from-surroundings">Pulling Data from Surroundings</a></h2><p>Blocks of Hamlet are able to include values taken from the surrounding
code. This is done using the hash curly brace syntax, <code>#{...}</code>. Imagine that
our handler action has pulled a few filenames from a database, and wants to
include it in the final HTML. Here is how you might do something like that.</p><pre><code class="active haskell web">{-# START_FILE Main.hs #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE QuasiQuotes #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TypeFamilies #-}

module Main where

import Yesod

data App = App
instance Yesod App

mkYesod &quot;App&quot; [parseRoutes|
/ HomeR GET
|]

-- show
getHomeR :: Handler Html
getHomeR = defaultLayout $ do
{-hi-}    let filename1 = &quot;readme.txt&quot; :: String
        filename2 = &quot;report.pdf&quot; :: String
        filename3 = &quot;music.wav&quot; :: String{-/hi-}
    setTitle &quot;File Processor&quot;
    toWidget [whamlet|
&lt;h2&gt;Previously submitted files
&lt;ul&gt;
$#    &lt;li&gt;readme.txt
$#    &lt;li&gt;report.pdf
$#    &lt;li&gt;music.wav
{-hi-}    &lt;li&gt;#{filename1}
    &lt;li&gt;#{filename2}
    &lt;li&gt;#{filename3}{-/hi-}
|]
-- /show

main :: IO ()
main = warpEnv App</code></pre><p>Haskell's <code>let</code> syntax binds a name to a value. Any type that can be converted
to HTML can be used. I've specified that each filename is a <code>String</code>. Haskell
is often able to figure out which type to use, but in this case it is not. Try
removing &quot;:: String&quot; from one of the filenames to see what error you
get. It's helpful to become familiar with compiler errors.</p><h2 id="looping-through-a-list"><a href="#looping-through-a-list">Looping Through a List</a></h2><p>Later on we'll use this technique of referencing Haskell values from within a
Hamlet template to pull data from our site's global state. When that time
comes we'll want a way of looping through multiple values to produce a list of
any length. Hamlet has a few special constructs for this kind of thing. Here
is an example of looping through a list.</p><pre><code class="active haskell web">{-# START_FILE Main.hs #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE QuasiQuotes #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TypeFamilies #-}

module Main where

import Yesod

data App = App
instance Yesod App

mkYesod &quot;App&quot; [parseRoutes|
/ HomeR GET
|]

-- show
getHomeR :: Handler Html
getHomeR = defaultLayout $ do
--    let filename1 = &quot;readme.txt&quot; :: String
--        filename2 = &quot;report.pdf&quot; :: String
--        filename3 = &quot;music.wav&quot; :: String
{-hi-}    let filenames = [&quot;readme.txt&quot;, &quot;report.pdf&quot;, &quot;music.wav&quot;] :: [String]{-/hi-}
    setTitle &quot;File Processor&quot;
    toWidget [whamlet|
&lt;h2&gt;Previously submitted files
&lt;ul&gt;
$#    &lt;li&gt;#{filename1}
$#    &lt;li&gt;#{filename2}
$#    &lt;li&gt;#{filename3}
{-hi-}    $forall filename &lt;- filenames
        &lt;li&gt;#{filename}{-/hi-}
|]
-- /show

main :: IO ()
main = warpEnv App</code></pre><p>In the <code>$forall</code> command, &quot;filename&quot; is bound to each element of the
&quot;filenames&quot; list. Hamlet has several other special commands besides these.</p><h2 id="conditionals"><a href="#conditionals">Conditionals</a></h2><p>Here is how we might use the <code>null</code> command and an if-else construct for
special handling in the case of an empty list.</p><pre><code class="active haskell web">{-# START_FILE Main.hs #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE QuasiQuotes #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TypeFamilies #-}

module Main where

import Yesod

data App = App
instance Yesod App

mkYesod &quot;App&quot; [parseRoutes|
/ HomeR GET
|]

-- show
getHomeR :: Handler Html
getHomeR = defaultLayout $ do
    let filenames = [] :: [String]
    setTitle &quot;File Processor&quot;
    toWidget [whamlet|
&lt;h2&gt;Previously submitted files
$# &lt;ul&gt;
$#    $forall filename &lt;- filenames
$#        &lt;li&gt;#{filename}
{-hi-}$if null filenames
    &lt;p&gt;No files have been uploaded yet.
$else
    &lt;ul&gt;
        $forall filename &lt;- filenames
            &lt;li&gt;#{filename}{-/hi-}
|]
-- /show

main :: IO ()
main = warpEnv App</code></pre><p>Try adding an entry or two into the <code>filenames</code> list to verify that the
<code>$else</code> branch is executed in that case.</p><h1 id="summary"><a href="#summary">Summary</a></h1><p>In this episode we looked at a minimal Yesod application, and saw how to
generate HTML using Hamlet templates. The next entry We will show you how to
organize a Yesod project.</p></article>

<div id="disqus_thread"><script>var disqus_shortname = "fpcomplete"; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })();</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a></a>
</div>

</div>
</div>
<div class="row article-footer"><div class="span7 meta"><span class="sociallinksunicode social">
<a href="https://twitter.com/home?status=$url$" target="_blank"><i class="icon-twitter"></i></a>&nbsp;
<a href="http://www.facebook.com/sharer/sharer.php?u=$url$" target="_blank"><i class="icon-facebook"></i></a>&nbsp;
<a href="https://plus.google.com/share?url=$url$" target="_blank"><i class="icon-google-plus"></i></a></span>
</div>
</div>
</div>
<div class="footer"><div class="container"><div class="row"><div class="span12"><ul class="menu"><li><a href="https://www.schoolofhaskell.com/">School</a>
</li>
<li><a href="https://www.schoolofhaskell.com/user">Users</a>
</li>

<li><a class="brand" href="https://fpcomplete.com">Sponsored by:
<img src="/static/img/logo.png" title="FPComplete">
</a>
</li>
</ul>
</div>
</div>
<div class="row"><div class="span12"></div>
</div>
</div>
</div>
<link rel="stylesheet" type="text/css" href="/static/bootstrap/css/bootstrap-responsive.css" />
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script><script src="https://www.schoolofhaskell.com/static/combined/Y-3k9_tW.js"></script><script>$(function(){
  $("a.logout").click(function(){
    var form = $("<form method='post'/>");
    form.attr("action", $(this).attr("href"));
    $("body").append(form);
    form.submit();
    return false;
  });
});

$(function(){
    $('.sociallinksunicode a').each(function(){
        $(this).attr('href',$(this).attr('href').replace('$url$',document.location));
    });
});

$(function(){
  // If we need to select a user/select a password then show the
  // details confirmation form, otherwise enable the getting started
  // section.
  if($('.alert-block a').text().match(/(selected a username|change your password)/)) {
    $("#confirm-details").show();
    $("#confirm-details #inputUsername").focus();
  } else {
    $("#get-started").removeClass('disabled').addClass('enabled');
  }

  // For lack of a plain HTML validation story this will do.
  $('.welcome-page').each(function(){
    $('form').submit(check);
  });
  function check(){
    setTimeout(check,500);
    var error = false;
    $('.error').removeClass('error');
    $('#enter-details input').each(function(){
      if($(this).val() == '') {
        $(this).parent().parent().addClass('error');
        error = true;
      }
    });
    if(error) return false;
    if($('[name=password]').val() == $('[name=confirm]').val()) {
      $('#confirm').removeClass('error');
      return true;
    } else {
      $('#confirm').addClass('error');
      return false;
    }
  }
});

$(function(){
  // When scrolling over a snippet editor, activate the "clone in IDE" popovers
  $('article').each(function(){
    var n = 100;
    var wait = 10000;
    function check(){
      if($('.clone').length == 0) {
        setTimeout(check,n);
        return;
      }
      var activated = $.cookie('clone-popover');
      if (activated) return;
      var activate = false;
      $('.controlsRun:onScreen').each(function(){
        $.cookie('clone-popover', 'true', { expires: 30, path: '/' });
        activate = true;
        return false;
      });
      if(activate) {
          $('.clone').each(function(){
              // The bootstrap API is rather unreasonable to say the
              // least.
              next = $(this).parent();
              var title = next.attr('title');
              next.attr('data-content',$(this).attr('data-content'));
              next.attr('title',$(this).attr('title'));
              next.popover('show',{
                  title: $(this).attr('title')
              });
              next.attr('title',title);
          });
          setTimeout(function(){
              $('.clone').each(function(){
                  $(this).parent().popover('hide');
              });
          },wait);
      } else {
        setTimeout(check,n);
      }
    }
    setTimeout(check,n);
  });
});

// onScreen jQuery plugin v0.2.1
// (c) 2011-2013 Ben Pickles
//
// http://benpickles.github.com/onScreen
//
// Released under MIT license.
(function(a){a.expr[":"].onScreen=function(b){var c=a(window),d=c.scrollTop(),e=c.height(),f=d+e,g=a(b),h=g.offset().top,i=g.height(),j=h+i;return h>=d&&h<f||j>d&&j<=f||i>e&&h<=d&&j>=f}})(jQuery);

/*!
 * jQuery Cookie Plugin v1.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
(function($, document) {

  var pluses = /\+/g;
  function raw(s) {
    return s;
  }
  function decoded(s) {
    return decodeURIComponent(s.replace(pluses, ' '));
  }

  $.cookie = function(key, value, options) {

    // key and at least value given, set cookie...
    if (arguments.length > 1 && (!/Object/.test(Object.prototype.toString.call(value)) || value == null)) {
      options = $.extend({}, $.cookie.defaults, options);

      if (value == null) {
	options.expires = -1;
      }

      if (typeof options.expires === 'number') {
	var days = options.expires, t = options.expires = new Date();
	t.setDate(t.getDate() + days);
      }

      value = String(value);

      return (document.cookie = [
	encodeURIComponent(key), '=', options.raw ? value : encodeURIComponent(value),
	options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
	options.path    ? '; path=' + options.path : '',
	options.domain  ? '; domain=' + options.domain : '',
	options.secure  ? '; secure' : ''
      ].join(''));
    }

    // key and possibly options given, get cookie...
    options = value || $.cookie.defaults || {};
    var decode = options.raw ? raw : decoded;
    var cookies = document.cookie.split('; ');
    for (var i = 0, parts; (parts = cookies[i] && cookies[i].split('=')); i++) {
      if (decode(parts.shift()) === key) {
	return decode(parts.join('='));
      }
    }
    return null;
  };
  $.cookie.defaults = {};})(jQuery, document);
</script><!--[if lt IE 10]><script src="https://www.schoolofhaskell.com/static/design/js/ie.js?etag=ayV2DuJ0"></script><![endif]--><script>if(!window.location.href.match(/localhost/)){var track = '/tutorial/school/advanced-haskell/building-a-file-hosting-service-in-yesod/part%201';
window._gaq = [['_setAccount','UA-36928035-1'],track != ''? ['_trackPageview',track] : ['_trackPageview']
,['_trackPageLoadTime']];window._gaq.push(['_setCustomVar',1,'Section','School of Haskell',3]);
window._gaq.push(['_setCustomVar',2,'User Type','Visitor',1]);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);

})();}</script>
<!-- Prompt IE 6 users to install Chrome Frame. Remove this if you want to support IE 6.  chromium.org/developers/how-tos/chrome-frame-getting-started --><!--[if lt IE 7 ]><script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script><script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script><![endif]--></body></html>